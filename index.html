<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Merced County 511 — Clean Build v2 (CMS polish, revert transit load)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://unpkg.com/maplibre-gl@3.5.2/dist/maplibre-gl.css" rel="stylesheet" />
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='18' fill='%230ea5e9'/%3E%3Ctext x='50' y='68' text-anchor='middle' font-family='system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif' font-size='62' fill='white'%3E511%3C/text%3E%3C/svg%3E">
  <meta name="theme-color" content="#0ea5e9">
  <style>
    :root { color-scheme: light dark; }
    html, body { height: 100%; margin: 0; padding: 0; }
    #map { width: 100%; height: 100%; }
    .panel { position:absolute; top:10px; left:10px; z-index:10; background:color-mix(in oklab, Canvas, CanvasText 10%/70%); backdrop-filter: blur(6px); padding:10px; border-radius:12px; font: 13px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; box-shadow: 0 4px 12px rgba(0,0,0,.15); max-width: 360px; }
    .panel h3 { margin:.25rem 0 .5rem; font-size:14px; }
    .row { display:flex; align-items:center; gap:.4rem; margin:.25rem 0; }
    .ctrl-btn { padding: 6px 10px; }
    label { user-select:none; }
    .legend { display:flex; flex-wrap:wrap; gap:.4rem .6rem; margin-top:.25rem; }
    .k { width:10px;height:10px;border-radius:2px;display:inline-block;margin-right:.3rem;vertical-align:middle;}
    .popup-list { max-width: 320px;}
    .popup-list button { display:block; width:100%; text-align:left; margin:.25rem 0; padding:.4rem .5rem; border-radius:8px; border:1px solid color-mix(in oklab, CanvasText 30%, transparent); background:color-mix(in oklab, Canvas, CanvasText 6%/60%); cursor:pointer; }

    .cms-sign { --led:#f7b500; --led-glow:#facc15; --face:#111; background: radial-gradient(120% 120% at 50% 50%, #000 0%, #0a0a0a 40%, #111 100%); color: var(--led); border-radius: 12px; border: 1px solid #222; box-shadow: inset 0 0 0 1px #000, 0 8px 24px rgba(0,0,0,.35); padding: 10px 12px; max-width: 320px; }
    .cms-header { font: 600 11px/1.2 ui-sans-serif, system-ui; letter-spacing: .06em; color: #cbd5e1; opacity: .8; margin-bottom: 6px; }
    .cms-lines { font: 700 18px/1.35 ui-monospace, SFMono-Regular, Menlo, Monaco, "Cascadia Code", Consolas, "Liberation Mono", monospace; letter-spacing: .08em; text-transform: uppercase; display: grid; gap: 2px; color: var(--led); text-shadow: 0 0 2px var(--led), 0 0 4px var(--led), 0 0 10px var(--led-glow); }
    .cms-line { padding: 2px 4px; background: radial-gradient(circle at 2px 2px, rgba(255,255,255,.06) 0 1px, transparent 2px) repeat; background-size: 8px 8px; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    .cms-meta { color:#94a3b8; font: 500 11px/1.2 ui-sans-serif, system-ui; margin-top:6px; }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="panel">
    <h3>Layers</h3>
    <div class="row"><input type="checkbox" id="chk-cctv" checked><label for="chk-cctv">CCTV</label></div>
    <div class="row"><input type="checkbox" id="chk-chp" checked><label for="chk-chp">CHP Incidents</label></div>
    <div class="row"><input type="checkbox" id="chk-lcs" checked><label for="chk-lcs">Lane Closures</label></div>
    <div class="row"><input type="checkbox" id="chk-cms" checked><label for="chk-cms">CMS Signs</label></div>
    <hr>
    <div class="row"><input type="checkbox" id="chk-nws" checked><label for="chk-nws">NWS Alerts</label></div>
    <div class="row"><input type="checkbox" id="chk-fog" checked><label for="chk-fog">Dense Fog Advisories</label></div>
    <div class="row"><input type="checkbox" id="chk-metar" checked><label for="chk-metar">Visibility (METAR, mi)</label></div>
    <div class="row"><input type="checkbox" id="chk-usgs" checked><label for="chk-usgs">USGS Streamgages</label></div>
    <hr>
    <div class="row"><input type="checkbox" id="chk-gtfs-bus" checked><label for="chk-gtfs-bus">The Bus (GTFS static)</label></div>
    <div class="row"><input type="checkbox" id="chk-rt-bus" checked><label for="chk-rt-bus">The Bus (GTFS‑RT vehicles)</label></div>
    <div class="row"><input type="checkbox" id="chk-gtfs-yarts" checked><label for="chk-gtfs-yarts">YARTS (GTFS static)</label></div>
    <div class="legend">
      <span><i class="k" style="background:#10b981"></i>CCTV</span>
      <span><i class="k" style="background:#6366f1"></i>CMS</span>
      <span><i class="k" style="background:#f59e0b"></i>CHP</span>
      <span><i class="k" style="background:#dc2626"></i>LCS</span>
      <span><i class="k" style="background:#1f2937"></i>Fog</span>
      <span><i class="k" style="background:#14b8a6"></i>USGS</span>
      <span><i class="k" style="background:#0ea5e9"></i>The Bus</span>
      <span><i class="k" style="background:#7c3aed"></i>YARTS</span>
    </div>
  </div>

  <script src="https://unpkg.com/maplibre-gl@3.5.2/dist/maplibre-gl.js"></script>
  <script src="https://unpkg.com/@tmcw/togeojson@7.1.2/dist/togeojson.umd.js"></script>
  <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://unpkg.com/protobufjs@7/dist/protobuf.min.js"></script>
  <!-- The JavaScript section remains as before with CMS cleanup -->
</body>
</html>
